<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>요청 관리</title>
    <link rel="stylesheet" th:href="@{/css/admin.css}" href="/css/admin.css">
</head>
<body>
<h1>📋 요청 관리 페이지</h1>

<div th:if="${requests.isEmpty()}" class="empty-message">
    <p>등록된 요청이 없습니다.</p>
</div>

<table th:if="${!requests.isEmpty()}">
    <thead>
    <tr>
        <th>ID</th>
        <th>이름</th>
        <th>연락처</th>
        <th>이메일</th>
        <th>작업범위</th>
        <th>마감일</th>
        <th>장르</th>
        <th>레퍼런스 URL</th>
        <th>추가 요청사항</th>
        <th>파일 다운로드</th>
        <th>등록일</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="req : ${requests}">
        <td th:text="${req.id}">1</td>
        <td th:text="${req.name}">홍길동</td>
        <td th:text="${req.contact}">010-1234-5678</td>
        <td th:text="${req.email}">email@example.com</td>
        <td th:text="${req.workScope}">작곡, 편곡</td>
        <td th:text="${req.deadline != null ? #temporals.format(req.deadline, 'yyyy-MM-dd') : '-'}">2025-12-31</td>
        <td th:text="${req.genre}">팝</td>

        <!-- 레퍼런스 URL -->
        <td class="url-cell">
            <a th:if="${req.referenceLink != null and !req.referenceLink.isEmpty()}"
               th:href="${req.referenceLink}"
               th:text="${req.referenceLink}"
               target="_blank">
                링크
            </a>
            <span th:unless="${req.referenceLink != null and !req.referenceLink.isEmpty()}"
                  class="no-data">없음</span>
        </td>

        <!-- 추가 요청사항 -->
        <td class="note-cell">
                    <span th:if="${req.note != null and !req.note.isEmpty()}"
                          th:text="${req.note}">요청 내용</span>
            <span th:unless="${req.note != null and !req.note.isEmpty()}"
                  class="no-data">없음</span>
        </td>

        <!-- 파일 다운로드 -->
        <td class="file-links">
            <div th:if="${req.guideFile != null and req.guideFile.length > 0}">
                <a th:href="@{/admin/requests/download/{id}/guide(id=${req.id})}" download>
                    🎤 가이드 (<span th:text="${#numbers.formatDecimal(req.guideFile.length / 1024.0 / 1024.0, 1, 2)}">0.00</span> MB)
                </a>
            </div>
            <div th:unless="${req.guideFile != null and req.guideFile.length > 0}" class="no-file">
                가이드 없음
            </div>

            <div th:if="${req.midiFile != null and req.midiFile.length > 0}">
                <a th:href="@{/admin/requests/download/{id}/midi(id=${req.id})}" download>
                    🎹 MIDI (<span th:text="${#numbers.formatDecimal(req.midiFile.length / 1024.0 / 1024.0, 1, 2)}">0.00</span> MB)
                </a>
            </div>
            <div th:unless="${req.midiFile != null and req.midiFile.length > 0}" class="no-file">
                MIDI 없음
            </div>

            <div th:if="${req.referenceFile != null and req.referenceFile.length > 0}">
                <a th:href="@{/admin/requests/download/{id}/reference(id=${req.id})}" download>
                    🎵 레퍼런스 (<span th:text="${#numbers.formatDecimal(req.referenceFile.length / 1024.0 / 1024.0, 1, 2)}">0.00</span> MB)
                </a>
            </div>
            <div th:unless="${req.referenceFile != null and req.referenceFile.length > 0}" class="no-file">
                레퍼런스 없음
            </div>
        </td>

        <td th:text="${#temporals.format(req.createdAt, 'yyyy-MM-dd HH:mm')}">2025-11-30 12:00</td>
    </tr>
    </tbody>
</table>
</body>
</html>